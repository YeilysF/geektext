{% extends "base.html" %}
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
{% load bookstore_extras %}
{% block content %}
    <h1>Browse & Sort Books</h1>

    <div class="dropdown">
    <button onclick="myFunction()" class="dropbtn">Browse by Genre</button>
    <div id="myDropdown" class="dropdown-content">
      {% for genre in my_genre_list %}
      <a href="?genre_selection={{ genre.name }}">{{ genre.name }}</a>
      {% endfor %}
    </div>
    </div>
    <div class="dropdown">
    <button onclick="myFunction2()" class="dropbtn">Sort</button>
    <div id="myDropdown2" class="dropdown-content">
      <a href="?order_by=book_title&direction=asc">Book Title</a>
      <a href="?order_by=author&direction=asc">Author</a>
      <a href="?order_by=price&direction=asc">Price</a>
      <a href="?order_by=rating&direction=asc">Rating</a>
      <a href="?order_by=release_date&direction=asc">Date</a>
    </div>
    </div>

  <script>
    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    function myFunction2() {
      document.getElementById("myDropdown2").classList.toggle("show");
    }
    function wishlistFunction(event, element, id) {
      document.getElementById("wishlistDropdown"+id).classList.toggle("show");
    }
    // function wishlistFunction(event, element, id) {
    //   // console.log(element.closest('.wishlist-dropdown'));
    //   // console.log($(element).closest('div').next().find('.wishlist-dropdown').classList);
    //   $(element).parents('div').find('.wishlist-dropdown').toggleClass("show");

    //   // $(element).closest('div').next().find('.wishlist-dropdown').toggleClass("show");

    //   // element.closest( ".wishlist-dropdown" ).toggleClass( "show" );
    //   // $(".wishlist-dropdown").classList.toggle("show");
    // }
    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
    </script>

    <table>
    {% if books %}
    <tr>
        <th style="text-align:center">Cover</th>
        <th style="text-align:center">Title</th>
        <th style="text-align:center">Author</th>
        <th style="text-align:center">Rating</th>
        <th style="text-align:center">Price</th>
    </tr>
    {% for book in books %}
    <tr class="clickable text-center">
    <td><img src="/media/{{ book.book_cover.url }}" onclick="window.location='{{ book.get_absolute_url }}'" width="200" height="280"/></td>
    <td onclick="window.location='{{ book.get_absolute_url }}'">{{ book.book_title }}</td>
    <td onclick="window.location='{{ book.get_absolute_url }}'">{{ book.author }}</td>
    <td onclick="window.location='{{ book.get_absolute_url }}'">{{ book.rating }}</td>
    <td onclick="window.location='{{ book.get_absolute_url }}'">{{ book.price }}</td>
        <td >
            <a class="btn btn-success" style="background-color: #428bca" href="{% url 'cart:add_cart' book.id %}">Add to Cart</a>
            <div class="dropdown">
              <button  onclick="wishlistFunction(event,this, {{book.id}} )" class="btn btn-danger wishlist-dropbtn dropbtn"  style="background-color: orangered">Add to Wishlist</button>
              <div id="wishlistDropdown{{book.id}}" class="dropdown-content wishlist-dropdown">
                <!-- {% for wishlist in wishlists %} -->
                  <!-- {% get_wishlist_books wishlist.id as books %} -->
                  <!-- {% if books.count >= 2 %} -->
                    <!-- <a href="?wishlist_selection={{ wishlist.id }}&book_id={{ book.id }}" class="isDisabled" title="Wishlist can Maximum contain 3 Books" >{{ wishlist.wishlist_name }}<span class="badge badge-danger">3 Books Allowed</span></a> -->
                  <!-- {% else %} -->
                    <a href="?wishlist_selection={{ wishlist.id }}&book_id={{ book.id }}">{{ wishlist.wishlist_name }}</a>
                  <!-- {% endif %} -->
                <!-- {% endfor %} -->
              </div>
            </div>
        </td>
    {% endfor %}
    </tr>
</table>
{% if p %}
{% if books.has_other_pages %}
<ul class="pagination">
  {% if books.has_previous %}
    <li><a href="?page={{ books.previous_page_number }}">&laquo;</a></li>
  {% else %}
    <li class="disabled"><span>&laquo;</span></li>
  {% endif %}
  {% for i in books.paginator.page_range %}
    {% if books.number == i %}
      <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
    {% else %}
      <li><a href="?page={{ i }}">{{ i }}</a></li>
    {% endif %}
  {% endfor %}
  {% if books.has_next %}
    <li><a href="?page={{ books.next_page_number }}">&raquo;</a></li>
  {% else %}
    <li class="disabled"><span>&raquo;</span></li>
  {% endif %}
</ul>
{% endif %}
{% else %}
      {% if books.has_other_pages %}
        <ul class="pagination">
          {% if books.has_previous %}
            <li><a href="?page={{ books.previous_page_number }}&order_by={{ order_by }}&direction={{ direction }}">&laquo;</a></li>
          {% else %}
            <li class="disabled"><span>&laquo;</span></li>
          {% endif %}
          {% for i in books.paginator.page_range %}
            {% if books.number == i %}
              <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
            {% else %}
              <li><a href="?page={{ i }}&order_by={{ order_by }}&direction={{ direction }}">{{ i }}</a></li>
            {% endif %}
          {% endfor %}
          {% if books.has_next %}
            <li><a href="?page={{ books.next_page_number }}&order_by={{ order_by }}&direction={{ direction }}">&raquo;</a></li>
          {% else %}
            <li class="disabled"><span>&raquo;</span></li>
          {% endif %}
        </ul>
      {% endif %}
{% endif %}
    {% else %}
      <p>There are no books in the library.</p>
    {% endif %}

{% endblock content %}
